---
title: Evolutionarily stable strategies

execute:
  echo: false
  freeze: true
  cache: true
---

As we saw earlier, one of the interpretations of mixed strategy NE is that it determines the fraction of population playing a certain pure strategy. @MaynardSmith1973 used this interpretation to propose an evolutionary mechanism via which organisms can change their behavior across generations. For a facinating (non-technical) introduction to the area, see @MaynardSmith1982. 

The key idea in what is now called **evolutionary game theory** is that of evolutionarily stable strategies, which we will discuss here. For detailed treatment of the subject, see @Sandholm2010.

## What is ESS

To understand evolutionary stability, consider the variation of Hawk-Dove game shown below.

```{julia}
#| output: false
# Install packages

# using Pkg; Pkg.activate(".")
# for pkg in ["IJulia", "Revise", "Hyperscript"]
#    Pkg.add(pkg)
# end
# 
# # Installing Jupyter Cache
# Pkg.add("Conda")
# using Conda
# Conda.add("jupyter-cache")

using Revise

include("../julia/typeset-games.jl")
```


```{julia}
game(["D", "H"], ["D", "H"], [4 2; 8 1], [4 8; 2 1], caption="A variation of the Hawk-Dove game")
```

Note that this is a symmetric game. Now suppose that there is a large population comprising of 80% doves and 20% hawks. THus, we are considering the population state $σ = (0.8, 0.2)$. 

We assume that there are repeated interactions between the organisms (or agents) in the population. At state $σ$ described above, a generic agent will encounter a dove with probability $0.8$ and a hawk with probability $0.2$. Thus, if this organism is a dove, his payoff is
$$
  U(\mathsf{D}, σ) = 0.8 × 4 + 0.2 × 2 = 3.6.
$$
On the other hand, if this organism is a hawk, then his payoff is
$$
  U(\mathsf{H}, σ) = 0.8 × 8 + 0.2 × 1 = 6.6.
$$
The argument of @MaynardSmith1982 is that in this situation, the population of hawks have an evolutionary advantage. So, over time, the fraction of hawks will increase. The population state $σ^*$ where no trait has an evolutionary advantage is given by
$$
  U(\mathsf{H}, σ^*) = U(\mathsf{D}, σ^*)
$$
which is precisely the NE of the game.

Now the key difference in this interpretation from NE is how we determine if an equilibrium is sustainable. To define sustainability, we introduce some notation. Consider a symmetric two player game $\mathscr{G} = \langle 2, (\ALPHABET S_1, \ALPHABET S_2), (u_1, u_2) \rangle$ where $\ALPHABET S_1 = \ALPHABET S_2$ and $u_1(s,t) = u_2(t,s)$ for all $t, s \in \ALPHABET S_1$. For the ease of notation, we will denote $\ALPHABET S_1$ and $\ALPHABET S_2$ simply as $\ALPHABET S$ (note that this is inconsistent with the notation that we use in general!) and denote the payoff function by $u \colon \ALPHABET S × \ALPHABET S \to \reals$ where
$$
  u(s,t) = u_1(s,t) = u_2(t,s).
$$

Consider a symmetric mixed strategy $σ^*$, i.e., we have a large population where $σ^*(s)$ fraction of the population is of type $s$, $s \in \ALPHABET S$. 

Now suppose a fraction $ε$ of the population **mutates** and starts playing another strategy $σ$. Thus, the new state of the population is 
$$
  \bar σ_{ε} = (1-ε) σ^* + ε σ
$$

Then, the average payoff of a **normal** player (i.e., the player belonging to the unmutated population) is
$$\def\1{\textcolor{red}{σ^*}}
  U(\1, \bar σ_{ε}) = (1-ε) U(\1, σ^*) + ε U(\1, σ).
$$
Similarly, the average payoff of a **mutated** player is 
$$\def\1{\textcolor{red}{σ}}
  U(\1, \bar σ_{ε}) = (1-ε) U(\1, σ^*) + ε U(\1, σ).
$$

:::{#def-ESS}
A population state $σ^*$ is said to be **evolutionarily stable strategy (ESS)** if for all mutations $σ \in Δ(\ALPHABET S)$, $σ \neq σ^*$, there exists a $ε_\circ = ε_\circ(α) > 0$ such that for all $ε \in (0, ε_\circ)$ and $\bar σ_{ε} = (1 -ε) σ^* + ε σ$, we have
$$
  U(σ^*, \bar σ_{ε}) > U (σ, \bar σ_{ε}).
$$
i.e.,
\begin{equation}\label{eq:ESS}
  (1-ε)U(σ^*, σ^*) + ε U(σ^*, σ) >
  (1-ε)U(σ, σ^*) + ε U(σ, σ).
\end{equation}
:::

## Relationship between NE and ESS

If we take the limit as $ε \to 0$ in the definition of ESS, we get that an ESS has be a symmetric NE. Thus, **all ESS are NE**. We now present an example to show that **not all NE are ESS.**

Consider the variation of Hawk Dove shown below.

```{julia}
game(["D", "H"], ["D", "H"], [4 2; 2 2], [4 2; 2 2], caption="A variation of the Hawk-Dove game")
```

This game has two pure strategy NE: $(\mathsf{D}, \mathsf{D})$ and $(\mathsf{H}, \mathsf{H})$. We now check if each of these is ESS.

- Consider the NE $(\mathsf{D}, \mathsf{D})$, i.e., $σ^* = (1,0)$. Consider a mutation $σ = (p, 1-p)$, where $p < 1$. Then,
  \begin{align*}
    U(σ^*, σ^*) &= 4  & U(σ^*, σ) &= 4p + 2(1-p) = 2p + 2 \\
    U(σ, σ^*) &= 2p + 2  & U(σ, σ) &= 4p^2 + 2(1-p^2) = 2p^2 + 2 
  \end{align*}
  Therefore,
  $$
    U(σ^*, σ_{ε}) = (1-ε)4 + ε(2p + 2) = 4 - 2 ε(1-p)
  $$
  and
  $$
    U(σ, σ_{ε}) = (1-ε)(2p+2) + ε(2p^2 + 2) = (2p+2) - 2p ε(1-p).
  $$
  Consider
  \begin{align*}
    U(σ^*, σ_{ε}) - U(σ, σ_{ε}) 
    &=
    4 - 2 ε(1-p) - (2p+2) + 2p ε(1-p) \\
    &= 
    2(1 - p - ε(1-p)^2) \\
    &= 2(1-p)(1 - ε(1-p))
  \end{align*}
  Thus, for any $p \in [0, 1)$ (note that $p=1$ is ruled out because the mutation cannot be the same as the normal population), and any $ε \in (0, 1)$, we have that 
  $$
    U(σ^*, σ_{ε}) - U(σ, σ_{ε}) > 0.
  $$
  So, **$(\mathsf{D}, \mathsf{D})$ is an ESS.**

- Consider the NE $(\mathsf{H}, \mathsf{H})$, i.e., $σ^* = (0, 1)$. Consider a mutation $(p, 1-p)$, where $p > 0$. Then,
  \begin{align*}
    U(σ^*, σ^*) &= 2  & U(σ^*, σ) &= 2 \\
    U(σ, σ^*) &= 2  & U(σ, σ) &= 4p^2 + 2(1-p^2) = 2p^2 + 2 
  \end{align*}
  Therefore,
  $$
    U(σ^*, σ_{ε}) = (1-ε)2 + ε2 = 2
  $$
  and
  $$
    U(σ, σ_{ε}) = (1-ε)2 + ε(2p^2 + 2) = 2 - 2 ε p^2
  $$
  Consider
  $$
    U(σ^*, σ_{ε}) - U(σ, σ_{ε}) 
    = 2 - 2 + 2 ε p^2 = 2 ε p^2
  $$
  which is strictly positive for any $p \in (0, 1]$ (note that $p = 0$ is ruled out because the mutation cannot be the same as the normal population) and $ε > 0$, we have
  $$
    U(σ^*, σ_{ε}) - U(σ, σ_{ε}) > 0.
  $$
  So, **$(\mathsf{H}, \mathsf{H})$ is not an ESS.**

## Necessary and sufficient conditions for ESS

:::{#thm-ESS}
A strategy $σ^*$ is ESS [if and only if]{.text-danger} for every $σ \neq σ^*$ one of the following conditions is true:

1. $U(σ^*, σ^*) > U(σ, σ^*)$

    [That is, if a mutation deviates from $σ^*$ it will lose in its encounters with the normal population]{.text-primary}

2. $U(σ^*, σ^*) = U(σ, σ^*)$ and $U(σ^*, σ) > U(σ,σ)$.

    [That is, if the payoff that a mutation receives from encountering the normal population is equal to the payoff that a normal indvidual receives from encountering the normal population, that mutation will receive a smaller payer if it encounters the same mutation than a normal individual will receive in the encounter]{.text-primary}
:::

:::{.callout-note}
#### Proof

- **ESS implies the two conditions:** Let $σ^*$ be an ESS. As argued earlier, this implies that $σ^*$ is also a NE. Thus,
  $$
    U(σ^*, σ^*) \ge U(σ, σ^*), \quad \forall σ \in Δ(\ALPHABET S).
  $$
  We prove the result by contradiction. Suppose that neither of the two conditions hold. Then, there must exist an $σ \neq σ^*$ such that
  $$
    U(σ^*, σ^*) = U(σ, σ^*) 
    \quad\text{and}\quad
    U(σ^*, σ) \le U(σ, σ).
  $$
  This implies that for any $ε \in (0,1)$
  $$
    (1-ε)U(σ^*, σ^*) + ε U(σ^*, σ) \le 
    (1-ε)U(σ, σ^*) + ε U(σ, σ)
  $$
  which contradicts the fact that $σ^*$ is ESS.

- **The two conditions imply ESS:** Suppose a mutation $σ$ satisfies condition 1. Let $D = U(σ^*, σ^*) - U(σ, σ^*)$ and 
  $$
    M = \max_{s,t} U(s,t) - \min_{s,t} u(s,t).
  $$
  Moreover, for any $ε \in (0,1)$, define $\bar σ_{ε} = (1-ε) σ^* + ε σ$. Then,
  \begin{align*}
    U(σ^*, \bar σ_{ε}) - U(σ, \bar σ_{ε}) &=
    (1-ε) \bigl[ U(σ^*, σ^*) - U(σ, σ^*) \bigr]
    +
    ε \bigl[ U(σ^*, σ) - U(σ, σ) \bigr]
    \\
    & \ge
    (1-ε) D - ε M 
  \end{align*}
  which is positive for $ε < D/(D+M)$. 

  Now suppose a mutation statisfied condition 2. Then,
  \begin{align*}
    U(σ^*, \bar σ_{ε}) - U(σ, \bar σ_{ε}) &=
    (1-ε) \underbrace{\bigl[ U(σ^*, σ^*) - U(σ, σ^*) \bigr]}_{=0}
    +
    ε \underbrace{\bigl[ U(σ^*, σ) - U(σ, σ) \bigr]}_{> 0}
    \\
    &> 0, \quad \forall ε \in (0,1).
 \end{align*}

 Since every mutation must satisfy either condition 1 or 2, we have that the strategy $σ^*$ is ESS. 
:::


:::{#exm-modified-hawk-dove}
Consider the modified Hawk Dove game shown below.

```{julia}
game(["D", "H"], ["D", "H"], [4 2; 8 1], [4 8; 2 1], caption="A variation of the Hawk-Dove game")
```

We can verify that the unique NE is $σ^* = (\tfrac 15, \tfrac 45)$. Is this an ESS?
:::

:::{.callout-note}
#### Solution

Consider a mutation $σ = (p, 1-p)$. We verify the two sufficient and necessary conditions of @thm-ESS separately.

- **Check condition 1:** Since $σ^*$ is a NE with support $\{\mathsf{H}, \mathsf{D}\}$, from irrelevance principle we must have
  $$
    U(\mathsf{H}, σ^*) = U(\mathsf{D}, σ^*).
  $$
  This means that for any mixed strategy $σ$, we will have
  $$
    U(σ, σ^*) = U(σ^*, σ^*).
  $$
  So, condition 1 is never satisfied.

- **Check condition 2:** Since $U(σ, σ^*) = U(σ^*, σ^*)$, condition 2 is satisfied if $U(σ^*, σ) > U(σ, σ)$. 
  Observe that
  $$
    U(σ^*, σ) = \frac{4p}{5} + \frac{2(1-p)}{5} + \frac{32p}{5} + \frac{4(1-p)}{5}
    = \frac{6}{5} + 6p
  $$
  and 
  $$
    U(σ, σ) = 4p^2 + 2p(1-p) + 8(1-p)p + (1-p)^2
    = 1 + 8p - 5p^2
    .
  $$
  Thus,
  $$
    U(σ^*, σ) - U(σ,σ) = \frac{1}{5} - 2p + 5p^2
    = \frac{(1-5p)^2}{5} 
  $$
  which is non-negative for all $p \neq \tfrac 15$ (i.e., all $σ \neq σ^*$). Thus, condition 2 holds and therefore $σ^*$ is ESS.
:::

## ESS for arbitrary two player $2 × 2$ symmeric games

Consider a symmetric two player $2 × 2$ game.

```{julia}
game(["1", "2"], ["1", "2"], ["a" "b"; "c" "d"], ["a" "c"; "b" "d"])
```

A symmetric mixed strategy $(σ^*, σ^*)$ with $σ^* = (p, 1-p)$ is a NE if and only if
$$
  a p + b(1-p) = c p + d (1-p) 
  \implies p = \frac{b - d}{(b+c) - (a+d)}.
$$
This is a valid probability distribution if either

1. Both numerator and denominator are positive and numerator is less than the denominator

2. Both numerator and denominator are negative and numerator is more than the denominator

Note that there wil also be cases where $b = d$ or $a = c$ where there will be multiple equilibria. We do not consider these cases here.

- **Case 1:** In this case, we have
  
  - numerator is positive, i.e., $b > d$
  - denominator is positive, i.e., $b+c > a + d$
  - numerator is less than denominator, i.e., $c > a$.

  Thus, 
  $$
  \bbox[5pt,border: 1px solid]{
    b > d \quad\text{and}\quad c > a
  }
  $$

- **Case 2:** In this case, we have
  
  - numerator is negative, i.e., $b < d$
  - denominator is negative, i.e., $b+c < a + d$
  - numerator is more than denominator, i.e., $c < a$.

  Thus, 
  $$
  \bbox[5pt,border: 1px solid]{
    b < d \quad\text{and}\quad c < a
  }
  $$

**When is this mixed strategy NE an ESS?**

Since $p \in (0,1)$, for any other $σ = (q, 1-q)$, we will have $U(σ, σ^*) = U(σ^*, σ^*)$. So, we only need to check condition 2 of @thm-ESS. For that mater, consider
\begin{align*}
  U(σ, σ^*) - U(σ, σ) &=
  (p - q) \big[ qa + (1-q) b \bigr] - (p - q) \bigl[ qc + (1-q) d \bigr]
  \\
  &= (p -q) \bigl[ b - d - q( (b+c) - (a+d) ) \bigr] \\
  &= (p - q)^2 ( (b+c) - (a+d) )
\end{align*}
where the last equality uses the fact that $b-d = p( (b+c) - (a+d) )$. 

Thus, in case 1 we have $U(σ, σ^*) - U(σ, σ)$ and therefore $σ^*$ is an ESS while in case 2 we have $U(σ, σ^*) - U(σ, σ) < 0$  and therefore $σ^*$ is not an ESS. 

:::{exm-hawk-dove-general}
#### General Hawk Dove game

Consider a general Hawk Dove game

```{julia}
game(["D", "H"], ["D", "H"], ["(v - c)//2" "v"; "0" "v//2"], ["(v-c)//2" "0"; "v" "v//2"], caption="A general Hawk-Dove game")
```

where

- $v$ denotes the value of the resource
- $C$ denotes the value lost due to fighting.

Characterize all NE of this game and verify if the symmetric NE are ESS.
:::

:::{.callout-note}
#### Solution

We have the following cases.

- If $\tfrac 12 (v-c) > 0$, then $(\mathsf{H}, \mathsf{H})$ is a NE in strictly dominated strategies (and also an ESS)

- If $\tfrac 12 (v-c) = 0$, then $(\mathsf{H}, \mathsf{H})$ is a NE in weakly dominated strategies (and not an ESS)

- If $\tfrac 12 (v-c) < 0$, then $(\mathsf{H}, \mathsf{D})$ and $(\mathsf{D}, \mathsf{H})$ are NE (but they are not symmetric). The symmetric NE in mixed strategies is $σ^* = (p, 1-p)$ where
  $$
    p = \frac{v - \tfrac 12 v}{v - (v - \frac{1}{2}c)} = \frac{v}{c}.
  $$
  Since in this case $v > \frac 12 v$ and $0 < \frac 12(v-c)$, we are in case 1 of the general setting and therefore this NE is ESS.
:::

:::{exm-MAC}
#### Medium Access Control

Consider a Medium Access Control game

```{julia}
game(["T", "D"], ["T", "D"], ["-c" "v-c"; "0" "0"], ["-c" "0"; "v-c" "0"], caption="Medium access control game")
```

where

- $v$ denotes the value of communication
- $c$ denotes the cost of communication

Assuming $v > c$, characterize all NE of this game and verify if the symmetric NE are ESS.
:::

:::{.callout-note}
#### Solution

In this case $(\mathsf{T}, \mathsf{D})$ and $(\mathsf{D}, \mathsf{T})$ are pure strategy NE of the game, but they are not symmetric. A symmetric mixed strategy of the form $(σ^*, σ^*)$ with $σ^* = (p, 1-p)$ is mixed strategy NE where
$$
  -pc + (v-c)(1-p) = 0 \implies p = 1 - \frac{c}{v}.
$$
Since, $v - c > 0$ and $0 > -c$, we are in case 1 of the general setting and therefore $σ^*$ is an ESS.
:::

:::{#exm-MAC-variation}
#### Medium Access Control with lost opportiunity cost
Consider a Medium Access Control game

```{julia}
game(["T", "D"], ["T", "D"], ["-c" "v-c"; "0" "-d"], ["-c" "0"; "v-c" "-d"], caption="Medium access control game with lost opportunity cost")
```

where

- $v$ denotes the value of communication
- $c$ denotes the cost of communication
- $d$ denotes the cost of wasted channel

Assuming $v > c$, characterize all NE of this game and verify if the symmetric NE are ESS.
:::
:::{.callout-note}
#### Solution

In this case $(\mathsf{T}, \mathsf{D})$ and $(\mathsf{D}, \mathsf{T})$ are pure strategy NE of the game, but they are not symmetric. A symmetric mixed strategy of the form $(σ^*, σ^*)$ with $σ^* = (p, 1-p)$ is mixed strategy NE where
$$
  -pc + (v-c)(1-p) = -d(1-p) \implies p = 1 - \frac{c}{v+d}.
$$
[Note that this shows that adding a lost opportunity cost is equivalent to increasing the value of communication]{.text-muted}

Since, $v - c > 0 > -d$ and $0 > -c$, we are in case 1 of the general setting and therefore $σ^*$ is an ESS.
:::

## A brief overview of evolutionary game theory

So far we have discussed evolutionarily stable equilibrium. In this section we discuss evolutionary game theory which rovides **revision protocols** that explain how a population state evolves over time to reach an ESS. 

Consider a two player symmetric game with finite strategy space. let $\ALPHABET S_1 = \ALPHABET S_2 = \{1, \dots, m\}$ and define
$$
  Δ^m = \biggl\{ (p_1, \dots, p_m) \in \reals^{m}_{\ge 0} : \sum_{i=1}^m p_i = 1 \biggr\}.
$$
For the ease of notation, we will use $p = (p_1, \dots, p_m)$ (instead of $σ$ used earlier) to denote a mixed strategy. 

The simplest form of revision protocol is called **replicator dynamics**. Suppose there is a large population of $N$ agents playing strategy $p$. Let $n_i = p_i N$ denote the number of agents playing pure strategy $i$. Suppose $r_i$ denotes the rate of change of $n_i$, i.e.,
$$
  \dot n_i = r_i n_i.
$$
This implies that
$$
  \dot N = \sum_{i=1}^m \dot n_i 
  = \sum_{i=1}^m r_i n_i = \bar r N
$$
where $\bar r = (r_1 p_1 + \dots + r_m p_m)$. 

Recall that $p_i = n_i/N$. Therefore,
$$
\dot p_i = \frac{\dot n_i N - n_i \dot N}{N^2}
= \frac{r_i n_i N - n_i \bar r N}{N^2} = p_i(r_i - \bar r).
$$
Thus, the differential equation
$$
  \bbox[5pt,border: 1px solid]{
    \dot p_i = p_i (r_i - \bar r)
  }
$$
tells us how the population state changes over time.

In general the rate $r_i$ of change of population $i$ is some function of the population state. Motivated by the theory of evolution, the simplest assumption is that the rate of change equals the fitness function, i.e., 
$$
  r_i = U(i, p).
$$
This means that
$$
  \bar r = \sum_{i=1}^m r_i p_i = \sum_{i=1}^m U(i,p) p_i = U(p, p).
$$
Substituting that back in the above differential equation we get
$$
  \bbox[5pt,border: 1px solid]{
    \dot p_i = p_i \bigl[ U(i,p)  - U(p,p) \bigr],
    \quad i \in \{1, \dots, m\}
  }
$$
This differential equation is called **replicator dynamics**.

An equilibrium point of this dynamics is one where $\dot p_i = 0$ for all $i$. This means that for all $i$ either $p_i = 0$ or $U(i,p) = U(p,p)$. **Thus, any NE of the game is an equilibrium point of the replicator dynamics.** The converse is not true. For example, every pure strategy $p$ satisfies the replicator dynamics. 

## Stability of equilibrium points of replicator dynamics

The next question is whether the equilibrium points of replicator dynamics are stable. Recall that there are three common notions of stability of differential equations. Consider the differential equation
$$
  \dot x = f(x)
$$ and let $x_e$ be an equilibrium point (i.e., $f(x_e) = 0$).

- **Lyapunov stability:**  if the intiail state lies in a small neighborhood of $x_e$, then the trajectory of the differential equation remains in the neighborhood.

- **Local asymptotic stability:** If the initial state lies in a neighborhood of $x_e$, then the trajectory of the trajectory of the differential equation converges to $x_e$.

- **Global asymptotic stability:** For any initial state, the trajectory of the differential equation converges to $x_e$.

The main result of replicator dynamics is the following.

:::{#thm-replicator}

1. An ESS $p^*$ is locally asymptotically stable equilibrium point of the replicator dyanmics.

2. An ESS $p^*$ in the interior of $Δ^m$ is a globally asymptotically stable equilibrium point of the replicator dynamics.
:::

:::{.callout-note}
#### Proof
The proof uses $V(p) = \prod_{i=1}^m p_i^{p_i^*}$ as a Lyapunov function. See @Hofbauer1979 for details.
:::

## Other evolutionary dynamics

Replicator dynamics are not ideal because they have the following property: if $p_i = 0$ at some point then $p_i = 0$ for all times in the future. To avoid this limitation, various other forms of evolutionary dynamics have been proposed in the literature. We list a few of them here:

- **Best response dynamics**
  $$ \dot p_i = \BR_i(p) - p_i, \quad i \in \{1, \dots, m\}. $$
  Since best response is not unique, this gives us a differential inclusion rather than a differential equation.

- **Smoothed best response dynamics**
  $$ \dot p_i = \sigma_i(p) - p_i, \quad i \in \{1, \dots, m\} $$
  where
  $$
    σ_i(p) = \frac{\exp(η U(i,p))}{\sum_{j=1}^m \exp(η U(j,p))}
  $$

- **Brown-von Neumann-Nash (BNN) dynamics:**
  $$
    \dot p_i = \hat U_i(p) - p_i \sum_{j=1}^m \hat U_j(p),
    \quad i \in \{1, \dots, m\}
  $$
  where
  $$
    \hat U_i(p) = \max\{ U(i,p) - U(p,p), 0 \}
  $$

There are various stability results for these dynamics. These results rely on the notion of **negative definite games** and **negative semi-definite games**. 

## Negative definite and semidefinite games

To be written

## Evolutionary dynamics and negative definite/semi-definite games

The main results for replicator dynamics is that for negative definite games (which have a unique NE that is also an ESS), the unique NE is globally asymptotically stable equilibrium point of replicator dynamics.

The big advantage of the modified dynamics is that for negative semi-definite games, the convex set of NE is globally asymptotically stable for BR and BNN dynamics. 

The smoothed BR dynamics have the advantage that they are always globally asymptotically stable but their equilibrium points are not NE but something called perturbed NE. 

[Add example]

See the book @Sandholm2010 for more details on evolutionary dynamics. 
  
